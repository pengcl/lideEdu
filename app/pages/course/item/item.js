"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var app = getApp();
Page({
    data: {
        fileUrl: '',
        poster: '',
        videoContext: '',
        item: {},
        options: ''
    },
    onLoad: function (options) {
        this.setData({ options: options });
        var that = this;
        app.getKey(function (userInfo) {
            if (!userInfo) {
                app.globalData.showLoginPanel = true;
            }
            else {
                wx.request({
                    url: app.globalData.prefix + 'getVideo',
                    method: 'POST',
                    data: { key: app.globalData.userInfo.key, id: options.id },
                    success: function (res) {
                        console.log(res.data.result);
                        that.setData({ item: res.data.result });
                        that.setData({ poster: app.globalData.filePrefix + res.data.result.coverFileId });
                        that.setData({ fileUrl: app.globalData.filePrefix + res.data.result.videoFileId });
                        that.videoContext = wx.createVideoContext('myVideo');
                    }
                });
            }
        });
    },
    requestPay: function () {
        var that = this;
        wx.request({
            url: app.globalData.prefix + 'wxMpPay',
            method: 'POST',
            data: { key: app.globalData.userInfo.key, id: this.data.item.id },
            success: function (res) {
                wx.requestPayment({
                    timeStamp: res.data.result.timeStamp,
                    nonceStr: res.data.result.nonceStr,
                    package: 'prepay_id=' + res.data.result.prepayId,
                    signType: 'MD5',
                    paySign: res.data.result.sign1,
                    success: function (res) {
                        if (res.errMsg === 'requestPayment:ok') {
                            that.onLoad(that.data.options);
                        }
                    }
                });
            }
        });
    },
    onShareAppMessage: function () {
        app.updateShare();
        return {
            title: '立得学堂',
            path: '/pages/data/item/item?id=' + this.data.options.id
        };
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIml0ZW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxJQUFNLEdBQUcsR0FBRyxNQUFNLEVBQVUsQ0FBQztBQUM3QixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixPQUFPLEVBQUUsRUFBRTtRQUNYLE1BQU0sRUFBQyxFQUFFO1FBQ1QsWUFBWSxFQUFFLEVBQUU7UUFDaEIsSUFBSSxFQUFFLEVBQUU7UUFDUixPQUFPLEVBQUMsRUFBRTtLQUNYO0lBQ0QsTUFBTSxZQUFDLE9BQU87UUFDWixJQUFJLENBQUMsT0FBUSxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7UUFDbkMsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBQyxRQUFhO1lBQ3ZCLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2IsR0FBRyxDQUFDLFVBQVUsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFBO2FBQ3JDO2lCQUFNO2dCQUNMLEVBQUUsQ0FBQyxPQUFPLENBQUM7b0JBQ1QsR0FBRyxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLFVBQVU7b0JBQ3ZDLE1BQU0sRUFBRSxNQUFNO29CQUNkLElBQUksRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLE9BQVEsQ0FBQyxFQUFFLEVBQUU7b0JBQzNELE9BQU8sWUFBQyxHQUFRO3dCQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQzt3QkFDN0IsSUFBSSxDQUFDLE9BQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7d0JBQ3pDLElBQUksQ0FBQyxPQUFRLENBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQzt3QkFDbkYsSUFBSSxDQUFDLE9BQVEsQ0FBQyxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO3dCQUNwRixJQUFJLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDdkQsQ0FBQztpQkFDRixDQUFDLENBQUM7YUFDSjtRQUNILENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNELFVBQVU7UUFDUixJQUFNLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbEIsRUFBRSxDQUFDLE9BQU8sQ0FBQztZQUNULEdBQUcsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxTQUFTO1lBQ3RDLE1BQU0sRUFBRSxNQUFNO1lBQ2QsSUFBSSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pFLE9BQU8sWUFBQyxHQUFRO2dCQUNkLEVBQUUsQ0FBQyxjQUFjLENBQUM7b0JBQ2hCLFNBQVMsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTO29CQUNwQyxRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUTtvQkFDbEMsT0FBTyxFQUFFLFlBQVksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRO29CQUNoRCxRQUFRLEVBQUUsS0FBSztvQkFDZixPQUFPLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSztvQkFDOUIsT0FBTyxFQUFFLFVBQUMsR0FBRzt3QkFDWCxJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssbUJBQW1CLEVBQUM7NEJBQ3JDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzt5QkFDaEM7b0JBQ0gsQ0FBQztpQkFDRixDQUFDLENBQUE7WUFDSixDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNELGlCQUFpQjtRQUNmLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNsQixPQUFPO1lBQ0wsS0FBSyxFQUFFLE1BQU07WUFDYixJQUFJLEVBQUUsMkJBQTJCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRTtTQUN6RCxDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElNeUFwcCB9IGZyb20gJy4uLy4uLy4uLy4uL2FwcCc7XG5jb25zdCBhcHAgPSBnZXRBcHA8SU15QXBwPigpO1xuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICBmaWxlVXJsOiAnJyxcbiAgICBwb3N0ZXI6JycsXG4gICAgdmlkZW9Db250ZXh0OiAnJyxcbiAgICBpdGVtOiB7fSxcbiAgICBvcHRpb25zOicnXG4gIH0sXG4gIG9uTG9hZChvcHRpb25zKSB7XG4gICAgdGhpcy5zZXREYXRhISh7IG9wdGlvbnM6IG9wdGlvbnN9KTtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBhcHAuZ2V0S2V5KCh1c2VySW5mbzogYW55KSA9PiB7XG4gICAgICBpZiAoIXVzZXJJbmZvKSB7XG4gICAgICAgIGFwcC5nbG9iYWxEYXRhLnNob3dMb2dpblBhbmVsID0gdHJ1ZVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd3gucmVxdWVzdCh7XG4gICAgICAgICAgdXJsOiBhcHAuZ2xvYmFsRGF0YS5wcmVmaXggKyAnZ2V0VmlkZW8nLCAvL+iAg+WJjei1hOaWmeWIl+ihqFxuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGRhdGE6IHsga2V5OiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mby5rZXksIGlkOiBvcHRpb25zIS5pZCB9LFxuICAgICAgICAgIHN1Y2Nlc3MocmVzOiBhbnkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhLnJlc3VsdCk7XG4gICAgICAgICAgICB0aGF0LnNldERhdGEhKHsgaXRlbTogcmVzLmRhdGEucmVzdWx0IH0pO1xuICAgICAgICAgICAgdGhhdC5zZXREYXRhISh7IHBvc3RlcjogYXBwLmdsb2JhbERhdGEuZmlsZVByZWZpeCArIHJlcy5kYXRhLnJlc3VsdC5jb3ZlckZpbGVJZCB9KTtcbiAgICAgICAgICAgIHRoYXQuc2V0RGF0YSEoeyBmaWxlVXJsOiBhcHAuZ2xvYmFsRGF0YS5maWxlUHJlZml4ICsgcmVzLmRhdGEucmVzdWx0LnZpZGVvRmlsZUlkIH0pO1xuICAgICAgICAgICAgdGhhdC52aWRlb0NvbnRleHQgPSB3eC5jcmVhdGVWaWRlb0NvbnRleHQoJ215VmlkZW8nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIHJlcXVlc3RQYXkoKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgd3gucmVxdWVzdCh7XG4gICAgICB1cmw6IGFwcC5nbG9iYWxEYXRhLnByZWZpeCArICd3eE1wUGF5JywgLy/ogIPliY3otYTmlpnliJfooahcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgZGF0YTogeyBrZXk6IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLmtleSwgaWQ6IHRoaXMuZGF0YS5pdGVtLmlkIH0sXG4gICAgICBzdWNjZXNzKHJlczogYW55KSB7XG4gICAgICAgIHd4LnJlcXVlc3RQYXltZW50KHtcbiAgICAgICAgICB0aW1lU3RhbXA6IHJlcy5kYXRhLnJlc3VsdC50aW1lU3RhbXAsXG4gICAgICAgICAgbm9uY2VTdHI6IHJlcy5kYXRhLnJlc3VsdC5ub25jZVN0cixcbiAgICAgICAgICBwYWNrYWdlOiAncHJlcGF5X2lkPScgKyByZXMuZGF0YS5yZXN1bHQucHJlcGF5SWQsXG4gICAgICAgICAgc2lnblR5cGU6ICdNRDUnLFxuICAgICAgICAgIHBheVNpZ246IHJlcy5kYXRhLnJlc3VsdC5zaWduMSxcbiAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzLmVyck1zZyA9PT0gJ3JlcXVlc3RQYXltZW50Om9rJyl7XG4gICAgICAgICAgICAgIHRoYXQub25Mb2FkKHRoYXQuZGF0YS5vcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIG9uU2hhcmVBcHBNZXNzYWdlKCkge1xuICAgIGFwcC51cGRhdGVTaGFyZSgpO1xuICAgIHJldHVybiB7XG4gICAgICB0aXRsZTogJ+eri+W+l+WtpuWggicsXG4gICAgICBwYXRoOiAnL3BhZ2VzL2RhdGEvaXRlbS9pdGVtP2lkPScgKyB0aGlzLmRhdGEub3B0aW9ucy5pZDtcbiAgICB9XG4gIH1cbn0pXG4iXX0=