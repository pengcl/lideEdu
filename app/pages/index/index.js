"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var util_1 = require("../../utils/util");
var app = getApp();
Page({
    data: {
        userInfo: {},
        typeId: 0,
        index: 0,
        array: [],
        objectArray: [],
        news: [],
        examTime: '',
        timer: {
            d: '00',
            h: '00',
            m: '00',
            s: '00'
        },
        exams: [],
        answers: [],
        infos: []
    },
    openPdf: function (e) {
        var type = e.currentTarget.dataset.type;
        var url = app.globalData.prefix + 'getExamAnswers';
        console.log(url);
        if (type === 'exam') {
            url = app.globalData.prefix + 'getExamInfo';
        }
        if (e.currentTarget.dataset.shared === 0) {
            wx.showModal({
                title: '温馨提示',
                content: '该模块需要分享才能查看！',
                confirmText: '马上分享',
                success: function (res) {
                    if (res.confirm) {
                        wx.navigateTo({ url: '/pages/share/share' });
                        console.log('用户点击确定');
                    }
                    else if (res.cancel) {
                        console.log('用户点击取消');
                    }
                }
            });
        }
        else {
            wx.downloadFile({
                url: app.globalData.filePrefix + e.currentTarget.dataset.id,
                success: function (res) {
                    var Path = res.tempFilePath;
                    wx.openDocument({
                        filePath: Path,
                        fileType: 'pdf',
                        success: function (res) {
                            wx.request({
                                url: url,
                                method: 'POST',
                                data: { key: app.globalData.userInfo.key, id: e.currentTarget.dataset.iid },
                                success: function () {
                                }
                            });
                        }
                    });
                },
                fail: function (res) {
                }
            });
        }
    },
    toPage: function (e) {
        app.globalData.dataTabIndex = e.currentTarget.dataset.index;
        wx.switchTab({ url: '../data/list/list' });
    },
    bindPickerChange: function (e) {
        app.globalData.userInfo.typeId = this.data.objectArray[e.detail.value].id;
        this.setData({
            index: e.detail.value,
            typeId: app.globalData.userInfo.typeId
        });
        this.getExams();
        this.getAnswers();
        this.getInfos();
        this.getVedios();
    },
    getVedios: function () {
        var that = this;
        wx.request({
            url: app.globalData.prefix + 'getVideoList',
            method: 'POST',
            data: { key: app.globalData.userInfo.key, id: app.globalData.userInfo.typeId, subjectId: '' },
            success: function (res) {
                that.setData({
                    news: res.data.result.list.slice(0, 3).map(function (item) {
                        item.title = item.title;
                        item.catalog = item.subjectName;
                        item.views = item.readNum;
                        item.date = util_1.formatTime(new Date(item.createTime));
                        item.mt = '0px';
                        item.show = true;
                        return item;
                    })
                });
            }
        });
    },
    getExams: function () {
        var that = this;
        wx.request({
            method: 'POST',
            url: app.globalData.prefix + 'getExamInfoList',
            data: { key: app.globalData.userInfo.key, id: app.globalData.userInfo.typeId },
            success: function (res) {
                that.setData({
                    exams: res.data.result.list.slice(0, 3).map(function (item) {
                        item.createTime = util_1.formatTime(new Date(item.createTime));
                        return item;
                    })
                });
            }
        });
    },
    getInfos: function () {
        var that = this;
        wx.request({
            url: app.globalData.prefix + 'getExamTimeList',
            method: 'POST',
            data: { key: app.globalData.userInfo.key, id: app.globalData.userInfo.typeId },
            success: function (res) {
                that.setData({
                    infos: res.data.result.list.map(function (info, index) {
                        var times = util_1.formatTime(new Date(info.examTime)).split('.');
                        info.examTime = times[1] + '.' + times[2];
                        if (index === 0) {
                            var examTime = times[0] + '/' + times[1] + '/' + times[2] + ' ' + info.subjectList[0].startTime + ':00';
                            that.timeDown(examTime);
                            that.setData({
                                examTime: times[1] + '月' + times[2] + '日'
                            });
                        }
                        return info;
                    })
                });
            }
        });
    },
    getAnswers: function () {
        var that = this;
        wx.request({
            url: app.globalData.prefix + 'getExamAnswersList',
            method: 'POST',
            data: { key: app.globalData.userInfo.key, id: app.globalData.userInfo.typeId },
            success: function (res) {
                that.setData({
                    answers: res.data.result.list.slice(0, 3).map(function (item) {
                        item.createTime = util_1.formatTime(new Date(item.createTime));
                        return item;
                    })
                });
            }
        });
    },
    onShow: function () {
        var _this = this;
        var that = this;
        app.getKey(function (userInfo) {
            if (!userInfo) {
                app.globalData.showLoginPanel = true;
            }
            else {
                if (userInfo.purePhoneNumber) {
                    userInfo.phoneNumber = userInfo.purePhoneNumber.substring(0, 3) + '****' + userInfo.purePhoneNumber.substring(7, 11);
                }
                _this.setData({
                    userInfo: userInfo,
                    typeId: app.globalData.userInfo.typeId
                });
                wx.request({
                    url: app.globalData.prefix + 'getProjectList',
                    data: {},
                    header: {
                        'content-type': 'application/json'
                    },
                    success: function (res) {
                        var array = [];
                        var objectArray = [];
                        res.data.result.list.forEach(function (item, index) {
                            array.push(item.projectName);
                            objectArray.push({
                                id: item.id,
                                name: item.projectName
                            });
                        });
                        that.setData({
                            typeId: app.globalData.userInfo.typeId,
                            index: util_1.getIndex(objectArray, 'id', app.globalData.userInfo.typeId),
                            array: array,
                            objectArray: objectArray
                        });
                        that.getExams();
                        that.getAnswers();
                        that.getInfos();
                        that.getVedios();
                    }
                });
            }
        });
    },
    goPage: function (e) {
        wx.navigateTo({
            url: '/pages/course/item/item?id=' + e.currentTarget.dataset.id,
        });
    },
    getUserInfo: function (e) {
        app.globalData.userInfo = e.detail.userInfo;
        this.setData({
            userInfo: e.detail.userInfo,
            hasUserInfo: true
        });
    },
    timeDown: function (endDateStr) {
        var _this = this;
        var endDate = new Date(endDateStr);
        var nowDate = new Date();
        var totalSeconds = parseInt((endDate - nowDate) / 1000);
        var days = Math.floor(totalSeconds / (60 * 60 * 24));
        var modulo = totalSeconds % (60 * 60 * 24);
        var hours = Math.floor(modulo / (60 * 60));
        modulo = modulo % (60 * 60);
        var minutes = Math.floor(modulo / 60);
        var seconds = modulo % 60;
        this.setData({
            timer: {
                d: days < 10 ? '0' + days : days,
                h: hours < 10 ? '0' + hours : hours,
                m: minutes < 10 ? '0' + minutes : minutes,
                s: seconds < 10 ? '0' + seconds : seconds
            }
        });
        setTimeout(function () {
            _this.timeDown(endDateStr);
        }, 1000);
    },
    onShareAppMessage: function () {
        app.updateShare();
        return {
            title: '教育成就美好未来',
            path: '/pages/index/index'
        };
    },
    getPhoneNumber: function (e) {
        var that = this;
        var pages = getCurrentPages();
        var currentPage = pages[pages.length - 1];
        var options = currentPage.options;
        console.log(e.detail.errMsg);
        if (e.detail.errMsg === 'getPhoneNumber:ok') {
            wx.request({
                url: app.globalData.prefix + 'initMember',
                method: 'POST',
                data: {
                    encryptedData: e.detail.encryptedData,
                    iv: e.detail.iv,
                    sessionKey: app.globalData.userInfo.sessionKey,
                    openid: app.globalData.userInfo.openId,
                    referee: options.scene ? decodeURIComponent(options.scene).split('&')[0] : ''
                },
                success: function (res) {
                    if (options.scene && decodeURIComponent(options.scene).split('&')[1]) { }
                    app.globalData.showLoginPanel = false;
                    app.globalData.userInfo.key = '';
                    that.onShow();
                }
            });
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUdBLHlDQUF3RDtBQUN4RCxJQUFNLEdBQUcsR0FBRyxNQUFNLEVBQVUsQ0FBQTtBQUU1QixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixRQUFRLEVBQUUsRUFBRTtRQUNaLE1BQU0sRUFBRSxDQUFDO1FBQ1QsS0FBSyxFQUFFLENBQUM7UUFDUixLQUFLLEVBQUUsRUFBRTtRQUNULFdBQVcsRUFBRSxFQUFFO1FBQ2YsSUFBSSxFQUFFLEVBQUU7UUFDUixRQUFRLEVBQUUsRUFBRTtRQUNaLEtBQUssRUFBRTtZQUNMLENBQUMsRUFBRSxJQUFJO1lBQ1AsQ0FBQyxFQUFFLElBQUk7WUFDUCxDQUFDLEVBQUUsSUFBSTtZQUNQLENBQUMsRUFBRSxJQUFJO1NBQ1I7UUFDRCxLQUFLLEVBQUUsRUFBRTtRQUNULE9BQU8sRUFBRSxFQUFFO1FBQ1gsS0FBSyxFQUFFLEVBQUU7S0FDVjtJQUNELE9BQU8sWUFBQyxDQUFNO1FBQ1osSUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQzFDLElBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLGdCQUFnQixDQUFDO1FBQ25ELE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxJQUFJLEtBQUssTUFBTSxFQUFFO1lBQ25CLEdBQUcsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxhQUFhLENBQUM7U0FDN0M7UUFDRCxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDeEMsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDWCxLQUFLLEVBQUUsTUFBTTtnQkFDYixPQUFPLEVBQUUsY0FBYztnQkFDdkIsV0FBVyxFQUFF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QUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO2lCQUM5RTtnQkFDRCxPQUFPLFlBQUMsR0FBUTtvQkFDZCxJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksa0JBQWtCLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHO29CQUN6RSxHQUFHLENBQUMsVUFBVSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUM7b0JBQ3RDLEdBQUcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7b0JBQ2pDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDaEIsQ0FBQzthQUNGLENBQUMsQ0FBQTtTQUNIO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vaW5kZXguanNcbi8v6I635Y+W5bqU55So5a6e5L6LXG5pbXBvcnQgeyBJTXlBcHAgfSBmcm9tICcuLi8uLi9hcHAnO1xuaW1wb3J0IHsgZ2V0SW5kZXgsIGZvcm1hdFRpbWUgfSBmcm9tICcuLi8uLi91dGlscy91dGlsJztcbmNvbnN0IGFwcCA9IGdldEFwcDxJTXlBcHA+KClcblxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICB1c2VySW5mbzoge30sXG4gICAgdHlwZUlkOiAwLFxuICAgIGluZGV4OiAwLFxuICAgIGFycmF5OiBbXSxcbiAgICBvYmplY3RBcnJheTogW10sXG4gICAgbmV3czogW10sXG4gICAgZXhhbVRpbWU6ICcnLFxuICAgIHRpbWVyOiB7XG4gICAgICBkOiAnMDAnLFxuICAgICAgaDogJzAwJyxcbiAgICAgIG06ICcwMCcsXG4gICAgICBzOiAnMDAnXG4gICAgfSxcbiAgICBleGFtczogW10sXG4gICAgYW5zd2VyczogW10sXG4gICAgaW5mb3M6IFtdXG4gIH0sXG4gIG9wZW5QZGYoZTogYW55KSB7XG4gICAgY29uc3QgdHlwZSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnR5cGU7XG4gICAgbGV0IHVybCA9IGFwcC5nbG9iYWxEYXRhLnByZWZpeCArICdnZXRFeGFtQW5zd2Vycyc7XG4gICAgY29uc29sZS5sb2codXJsKTtcbiAgICBpZiAodHlwZSA9PT0gJ2V4YW0nKSB7XG4gICAgICB1cmwgPSBhcHAuZ2xvYmFsRGF0YS5wcmVmaXggKyAnZ2V0RXhhbUluZm8nO1xuICAgIH1cbiAgICBpZiAoZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuc2hhcmVkID09PSAwKSB7XG4gICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICB0aXRsZTogJ+a4qemmqOaPkOekuicsXG4gICAgICAgIGNvbnRlbnQ6ICfor6XmqKHlnZfpnIDopoHliIbkuqvmiY3og73mn6XnnIvvvIEnLFxuICAgICAgICBjb25maXJtVGV4dDogJ+mprOS4iuWIhuS6qycsXG4gICAgICAgIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XG4gICAgICAgICAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiAnL3BhZ2VzL3NoYXJlL3NoYXJlJyB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfnlKjmiLfngrnlh7vnoa7lrponKVxuICAgICAgICAgIH0gZWxzZSBpZiAocmVzLmNhbmNlbCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+eUqOaIt+eCueWHu+WPlua2iCcpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICB3eC5kb3dubG9hZEZpbGUoe1xuICAgICAgICB1cmw6IGFwcC5nbG9iYWxEYXRhLmZpbGVQcmVmaXggKyBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pZCxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgIHZhciBQYXRoID0gcmVzLnRlbXBGaWxlUGF0aCAgICAgICAgICAgICAgLy/ov5Tlm57nmoTmlofku7bkuLTml7blnLDlnYDvvIznlKjkuo7lkI7pnaLmiZPlvIDmnKzlnLDpooTop4jmiYDnlKhcbiAgICAgICAgICB3eC5vcGVuRG9jdW1lbnQoe1xuICAgICAgICAgICAgZmlsZVBhdGg6IFBhdGgsXG4gICAgICAgICAgICBmaWxlVHlwZTogJ3BkZicsXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgIHVybDogdXJsLCAvL+iOt+WPluivpuaDhVxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHsga2V5OiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mby5rZXksIGlkOiBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5paWQgfSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgZmFpbDogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIHRvUGFnZShlOiBhbnkpIHtcbiAgICBhcHAuZ2xvYmFsRGF0YS5kYXRhVGFiSW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcbiAgICB3eC5zd2l0Y2hUYWIoeyB1cmw6ICcuLi9kYXRhL2xpc3QvbGlzdCcgfSlcbiAgfSxcbiAgYmluZFBpY2tlckNoYW5nZTogZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLnR5cGVJZCA9IHRoaXMuZGF0YS5vYmplY3RBcnJheVtlLmRldGFpbC52YWx1ZV0uaWQ7XG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBpbmRleDogZS5kZXRhaWwudmFsdWUsXG4gICAgICB0eXBlSWQ6IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLnR5cGVJZFxuICAgIH0pO1xuICAgIHRoaXMuZ2V0RXhhbXMoKTtcbiAgICB0aGlzLmdldEFuc3dlcnMoKTtcbiAgICB0aGlzLmdldEluZm9zKCk7XG4gICAgdGhpcy5nZXRWZWRpb3MoKTtcbiAgfSxcbiAgZ2V0VmVkaW9zKCkge1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgdXJsOiBhcHAuZ2xvYmFsRGF0YS5wcmVmaXggKyAnZ2V0VmlkZW9MaXN0JywgLy/ogIPliY3otYTmlpnliJfooahcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgZGF0YTogeyBrZXk6IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLmtleSwgaWQ6IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLnR5cGVJZCwgc3ViamVjdElkOiAnJyB9LFxuICAgICAgc3VjY2VzcyhyZXM6IGFueSkge1xuICAgICAgICB0aGF0LnNldERhdGEhKHtcbiAgICAgICAgICBuZXdzOiByZXMuZGF0YS5yZXN1bHQubGlzdC5zbGljZSgwLCAzKS5tYXAoKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICAgICAgaXRlbS50aXRsZSA9IGl0ZW0udGl0bGU7XG4gICAgICAgICAgICBpdGVtLmNhdGFsb2cgPSBpdGVtLnN1YmplY3ROYW1lO1xuICAgICAgICAgICAgaXRlbS52aWV3cyA9IGl0ZW0ucmVhZE51bTtcbiAgICAgICAgICAgIGl0ZW0uZGF0ZSA9IGZvcm1hdFRpbWUobmV3IERhdGUoaXRlbS5jcmVhdGVUaW1lKSk7XG4gICAgICAgICAgICBpdGVtLm10ID0gJzBweCc7XG4gICAgICAgICAgICBpdGVtLnNob3cgPSB0cnVlXG4gICAgICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgZ2V0RXhhbXMoKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgd3gucmVxdWVzdCh7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIHVybDogYXBwLmdsb2JhbERhdGEucHJlZml4ICsgJ2dldEV4YW1JbmZvTGlzdCcsIC8v6ICD5YmN6LWE5paZ5YiX6KGoXG4gICAgICBkYXRhOiB7IGtleTogYXBwLmdsb2JhbERhdGEudXNlckluZm8ua2V5LCBpZDogYXBwLmdsb2JhbERhdGEudXNlckluZm8udHlwZUlkIH0sXG4gICAgICBzdWNjZXNzKHJlczogYW55KSB7XG4gICAgICAgIHRoYXQuc2V0RGF0YSEoe1xuICAgICAgICAgIGV4YW1zOiByZXMuZGF0YS5yZXN1bHQubGlzdC5zbGljZSgwLCAzKS5tYXAoKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICAgICAgaXRlbS5jcmVhdGVUaW1lID0gZm9ybWF0VGltZShuZXcgRGF0ZShpdGVtLmNyZWF0ZVRpbWUpKVxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgZ2V0SW5mb3MoKSB7XG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgd3gucmVxdWVzdCh7XG4gICAgICB1cmw6IGFwcC5nbG9iYWxEYXRhLnByZWZpeCArICdnZXRFeGFtVGltZUxpc3QnLCAvL+iAg+WJjei1hOaWmeWIl+ihqFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBkYXRhOiB7IGtleTogYXBwLmdsb2JhbERhdGEudXNlckluZm8ua2V5LCBpZDogYXBwLmdsb2JhbERhdGEudXNlckluZm8udHlwZUlkIH0sXG4gICAgICBzdWNjZXNzKHJlczogYW55KSB7XG4gICAgICAgIHRoYXQuc2V0RGF0YSEoe1xuICAgICAgICAgIGluZm9zOiByZXMuZGF0YS5yZXN1bHQubGlzdC5tYXAoKGluZm86IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGltZXMgPSBmb3JtYXRUaW1lKG5ldyBEYXRlKGluZm8uZXhhbVRpbWUpKS5zcGxpdCgnLicpO1xuICAgICAgICAgICAgaW5mby5leGFtVGltZSA9IHRpbWVzWzFdICsgJy4nICsgdGltZXNbMl07XG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICAgY29uc3QgZXhhbVRpbWUgPSB0aW1lc1swXSArICcvJyArIHRpbWVzWzFdICsgJy8nICsgdGltZXNbMl0gKyAnICcgKyBpbmZvLnN1YmplY3RMaXN0WzBdLnN0YXJ0VGltZSArICc6MDAnO1xuICAgICAgICAgICAgICB0aGF0LnRpbWVEb3duKGV4YW1UaW1lKTtcbiAgICAgICAgICAgICAgdGhhdC5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgZXhhbVRpbWU6IHRpbWVzWzFdICsgJ+aciCcgKyB0aW1lc1syXSArICfml6UnXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaW5mbztcbiAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgZ2V0QW5zd2VycygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICB3eC5yZXF1ZXN0KHtcbiAgICAgIHVybDogYXBwLmdsb2JhbERhdGEucHJlZml4ICsgJ2dldEV4YW1BbnN3ZXJzTGlzdCcsIC8v562U6aKY5a+554Wn5YiX6KGoXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IHsga2V5OiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mby5rZXksIGlkOiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mby50eXBlSWQgfSxcbiAgICAgIHN1Y2Nlc3MocmVzOiBhbnkpIHtcbiAgICAgICAgdGhhdC5zZXREYXRhISh7XG4gICAgICAgICAgYW5zd2VyczogcmVzLmRhdGEucmVzdWx0Lmxpc3Quc2xpY2UoMCwgMykubWFwKChpdGVtOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGl0ZW0uY3JlYXRlVGltZSA9IGZvcm1hdFRpbWUobmV3IERhdGUoaXRlbS5jcmVhdGVUaW1lKSlcbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIG9uU2hvdygpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBhcHAuZ2V0S2V5KCh1c2VySW5mbzogYW55KSA9PiB7XG4gICAgICBpZiAoIXVzZXJJbmZvKSB7XG4gICAgICAgIGFwcC5nbG9iYWxEYXRhLnNob3dMb2dpblBhbmVsID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh1c2VySW5mby5wdXJlUGhvbmVOdW1iZXIpIHtcbiAgICAgICAgICB1c2VySW5mby5waG9uZU51bWJlciA9IHVzZXJJbmZvLnB1cmVQaG9uZU51bWJlci5zdWJzdHJpbmcoMCwgMykgKyAnKioqKicgKyB1c2VySW5mby5wdXJlUGhvbmVOdW1iZXIuc3Vic3RyaW5nKDcsIDExKVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgIHVzZXJJbmZvOiB1c2VySW5mbyxcbiAgICAgICAgICB0eXBlSWQ6IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLnR5cGVJZFxuICAgICAgICB9KVxuICAgICAgICB3eC5yZXF1ZXN0KHtcbiAgICAgICAgICB1cmw6IGFwcC5nbG9iYWxEYXRhLnByZWZpeCArICdnZXRQcm9qZWN0TGlzdCcsIC8v6I635Y+W6aG555uu5YiX6KGoXG4gICAgICAgICAgZGF0YToge30sXG4gICAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIC8vIOm7mOiupOWAvFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3VjY2VzcyhyZXM6IGFueSkge1xuICAgICAgICAgICAgY29uc3QgYXJyYXk6IGFueVtdID0gW107XG4gICAgICAgICAgICBjb25zdCBvYmplY3RBcnJheTogYW55W10gPSBbXTtcbiAgICAgICAgICAgIHJlcy5kYXRhLnJlc3VsdC5saXN0LmZvckVhY2goKGl0ZW06IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICBhcnJheS5wdXNoKGl0ZW0ucHJvamVjdE5hbWUpO1xuICAgICAgICAgICAgICBvYmplY3RBcnJheS5wdXNoKHtcbiAgICAgICAgICAgICAgICBpZDogaXRlbS5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBpdGVtLnByb2plY3ROYW1lXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoYXQuc2V0RGF0YSEoe1xuICAgICAgICAgICAgICB0eXBlSWQ6IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLnR5cGVJZCxcbiAgICAgICAgICAgICAgaW5kZXg6IGdldEluZGV4KG9iamVjdEFycmF5LCAnaWQnLCBhcHAuZ2xvYmFsRGF0YS51c2VySW5mby50eXBlSWQpLFxuICAgICAgICAgICAgICBhcnJheTogYXJyYXksXG4gICAgICAgICAgICAgIG9iamVjdEFycmF5OiBvYmplY3RBcnJheVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGF0LmdldEV4YW1zKCk7XG4gICAgICAgICAgICB0aGF0LmdldEFuc3dlcnMoKTtcbiAgICAgICAgICAgIHRoYXQuZ2V0SW5mb3MoKTtcbiAgICAgICAgICAgIHRoYXQuZ2V0VmVkaW9zKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgZ29QYWdlKGU6IGFueSkge1xuICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgdXJsOiAnL3BhZ2VzL2NvdXJzZS9pdGVtL2l0ZW0/aWQ9JyArIGUuY3VycmVudFRhcmdldC5kYXRhc2V0LmlkLFxuICAgIH0pXG4gIH0sXG4gIGdldFVzZXJJbmZvKGU6IGFueSkge1xuICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvID0gZS5kZXRhaWwudXNlckluZm9cbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHVzZXJJbmZvOiBlLmRldGFpbC51c2VySW5mbyxcbiAgICAgIGhhc1VzZXJJbmZvOiB0cnVlXG4gICAgfSlcbiAgfSxcbiAgdGltZURvd24oZW5kRGF0ZVN0cjogYW55KSB7XG4gICAgLy/nu5PmnZ/ml7bpl7RcbiAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoZW5kRGF0ZVN0cik7XG4gICAgLy/lvZPliY3ml7bpl7RcbiAgICBjb25zdCBub3dEYXRlID0gbmV3IERhdGUoKTtcbiAgICAvL+ebuOW3rueahOaAu+enkuaVsFxuICAgIGNvbnN0IHRvdGFsU2Vjb25kcyA9IHBhcnNlSW50KChlbmREYXRlIC0gbm93RGF0ZSkgLyAxMDAwKTtcbiAgICAvL+WkqeaVsFxuICAgIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKHRvdGFsU2Vjb25kcyAvICg2MCAqIDYwICogMjQpKTtcbiAgICAvL+WPluaooe+8iOS9meaVsO+8iVxuICAgIGxldCBtb2R1bG8gPSB0b3RhbFNlY29uZHMgJSAoNjAgKiA2MCAqIDI0KTtcbiAgICAvL+Wwj+aXtuaVsFxuICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihtb2R1bG8gLyAoNjAgKiA2MCkpO1xuICAgIG1vZHVsbyA9IG1vZHVsbyAlICg2MCAqIDYwKTtcbiAgICAvL+WIhumSn1xuICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKG1vZHVsbyAvIDYwKTtcbiAgICAvL+enklxuICAgIHZhciBzZWNvbmRzID0gbW9kdWxvICUgNjA7XG4gICAgLy/ovpPlh7rliLDpobXpnaJcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIHRpbWVyOiB7XG4gICAgICAgIGQ6IGRheXMgPCAxMCA/ICcwJyArIGRheXMgOiBkYXlzLFxuICAgICAgICBoOiBob3VycyA8IDEwID8gJzAnICsgaG91cnMgOiBob3VycyxcbiAgICAgICAgbTogbWludXRlcyA8IDEwID8gJzAnICsgbWludXRlcyA6IG1pbnV0ZXMsXG4gICAgICAgIHM6IHNlY29uZHMgPCAxMCA/ICcwJyArIHNlY29uZHMgOiBzZWNvbmRzXG4gICAgICB9XG4gICAgfSk7XG4gICAgLy/lu7bov5/kuIDnp5LmiafooYzoh6rlt7FcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMudGltZURvd24oZW5kRGF0ZVN0cik7XG4gICAgfSwgMTAwMClcbiAgfSxcbiAgb25TaGFyZUFwcE1lc3NhZ2UoKSB7XG4gICAgYXBwLnVwZGF0ZVNoYXJlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRpdGxlOiAn5pWZ6IKy5oiQ5bCx576O5aW95pyq5p2lJyxcbiAgICAgIHBhdGg6ICcvcGFnZXMvaW5kZXgvaW5kZXgnXG4gICAgfVxuICB9LFxuICBnZXRQaG9uZU51bWJlcihlOiBhbnkpIHtcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICBjb25zdCBwYWdlcyA9IGdldEN1cnJlbnRQYWdlcygpO1xuICAgIGNvbnN0IGN1cnJlbnRQYWdlID0gcGFnZXNbcGFnZXMubGVuZ3RoIC0gMV07XG4gICAgY29uc3Qgb3B0aW9ucyA9IGN1cnJlbnRQYWdlLm9wdGlvbnM7XG4gICAgY29uc29sZS5sb2coZS5kZXRhaWwuZXJyTXNnKTtcbiAgICBpZiAoZS5kZXRhaWwuZXJyTXNnID09PSAnZ2V0UGhvbmVOdW1iZXI6b2snKSB7XG4gICAgICB3eC5yZXF1ZXN0KHtcbiAgICAgICAgdXJsOiBhcHAuZ2xvYmFsRGF0YS5wcmVmaXggKyAnaW5pdE1lbWJlcicsIC8v6I635Y+W6aG555uu5YiX6KGoXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZW5jcnlwdGVkRGF0YTogZS5kZXRhaWwuZW5jcnlwdGVkRGF0YSxcbiAgICAgICAgICBpdjogZS5kZXRhaWwuaXYsXG4gICAgICAgICAgc2Vzc2lvbktleTogYXBwLmdsb2JhbERhdGEudXNlckluZm8uc2Vzc2lvbktleSxcbiAgICAgICAgICBvcGVuaWQ6IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLm9wZW5JZCxcbiAgICAgICAgICByZWZlcmVlOiBvcHRpb25zLnNjZW5lID8gZGVjb2RlVVJJQ29tcG9uZW50KG9wdGlvbnMuc2NlbmUpLnNwbGl0KCcmJylbMF0gOiAnJ1xuICAgICAgICB9LFxuICAgICAgICBzdWNjZXNzKHJlczogYW55KSB7XG4gICAgICAgICAgaWYgKG9wdGlvbnMuc2NlbmUgJiYgZGVjb2RlVVJJQ29tcG9uZW50KG9wdGlvbnMuc2NlbmUpLnNwbGl0KCcmJylbMV0pIHsgfVxuICAgICAgICAgIGFwcC5nbG9iYWxEYXRhLnNob3dMb2dpblBhbmVsID0gZmFsc2U7XG4gICAgICAgICAgYXBwLmdsb2JhbERhdGEudXNlckluZm8ua2V5ID0gJyc7XG4gICAgICAgICAgdGhhdC5vblNob3coKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cbn0pXG4iXX0=